<view class="container safe-area-inset-top">
  <!-- 自定义导航栏 -->
  <view class="custom-nav">
    <view class="nav-back" bindtap="cancel">
      <icon type="left" size="20" color="#333"></icon>
    </view>
    <view class="nav-title">添加器材</view>
    <view class="nav-right" bindtap="showHelp">
      <icon type="info" size="20" color="#333"></icon>
    </view>
  </view>

  <!-- 表单卡片 -->
  <view class="form-card">
    <!-- 名称输入 -->
    <view class="form-group">
      <view class="form-label">
        器材名称 
        <text class="required-mark">*</text>
      </view>
      <input 
        class="form-control {{nameError ? 'error' : ''}}" 
        placeholder="请输入器材名称" 
        value="{{equipment.name}}"
        bindinput="handleInput"
        data-field="name"
        focus="{{focusField === 'name'}}"
        maxlength="50"
      />
      <view wx:if="{{nameError}}" class="error-text">{{nameError}}</view>
    </view>
    
    <!-- 类型选择 -->
    <view class="form-group">
      <view class="form-label">
        器材类型 
        <text class="required-mark">*</text>
      </view>
      <picker 
        class="form-control picker-view {{typeError ? 'error' : ''}}"
        value="{{typeIndex}}" 
        range="{{typeOptions}}"
        bindchange="handleTypeChange"
      >
        <view class="picker-text">{{typeOptions[typeIndex] || '请选择器材类型'}}</view>
      </picker>
      <view wx:if="{{typeError}}" class="error-text">{{typeError}}</view>
    </view>
    
    <!-- 规格型号（带扫码） -->
    <view class="form-group">
      <view class="form-label">规格型号</view>
      <view class="input-with-action">
        <input 
          class="form-control" 
          placeholder="请输入规格型号或扫码获取" 
          value="{{equipment.specification}}"
          bindinput="handleInput"
          data-field="specification"
          maxlength="100"
        />
        <button class="action-btn" bindtap="scanCode">
          <image src="/images/function/func-scan.png" class="action-icon"></image>
        </button>
      </view>
    </view>
    
    <!-- 数量选择 -->
    <view class="form-group">
      <view class="form-label">
        数量 
        <text class="required-mark">*</text>
      </view>
      <view class="quantity-control {{quantityError ? 'error' : ''}}">
        <button class="quantity-btn" bindtap="decreaseQuantity" disabled="{{equipment.quantity <= 1}}">-</button>
        <input 
          class="quantity-input" 
          type="number"
          value="{{equipment.quantity}}"
          bindinput="handleInput"
          data-field="quantity"
          min="1"
        />
        <button class="quantity-btn" bindtap="increaseQuantity">+</button>
      </view>
      <view wx:if="{{quantityError}}" class="error-text">{{quantityError}}</view>
    </view>
    
    <!-- 存放位置 -->
    <view class="form-group">
      <view class="form-label">存放位置</view>
      <input 
        class="form-control" 
        placeholder="请输入存放位置（如：A栋302仓库）" 
        value="{{equipment.location}}"
        bindinput="handleInput"
        data-field="location"
        maxlength="50"
      />
    </view>
    
    <!-- 状态选择 -->
    <view class="form-group">
      <view class="form-label">状态</view>
      <picker 
        class="form-control picker-view"
        value="{{statusIndex}}" 
        range="{{statusOptions}}"
        bindchange="handleStatusChange"
      >
        <view class="picker-text">{{statusOptions[statusIndex]}}</view>
      </picker>
    </view>
    
    <!-- 备注信息 -->
    <view class="form-group">
      <view class="form-label">备注</view>
      <textarea 
        class="form-control textarea" 
        placeholder="请输入备注信息（可选）" 
        value="{{equipment.remarks}}"
        bindinput="handleInput"
        data-field="remarks"
        maxlength="200"
        auto-height
      />
      <view class="word-count">{{equipment.remarks.length}}/200</view>
    </view>
  </view>
  
  <!-- 底部按钮组 -->
  <view class="bottom-btn-group safe-area-inset-bottom">
    <button class="dialog-btn cancel-btn" bindtap="showCancelConfirm">取消</button>
    <button class="dialog-btn confirm-btn" bindtap="saveEquipment" loading="{{isSaving}}">保存</button>
  </view>

  <!-- 帮助提示弹窗 -->
  <view wx:if="{{showHelpDialog}}" class="dialog-mask" bindtap="hideHelpDialog"></view>
  <view wx:if="{{showHelpDialog}}" class="dialog help-dialog">
    <view class="dialog-header">
      <view class="dialog-title">填写帮助</view>
      <view class="dialog-close" bindtap="hideHelpDialog">×</view>
    </view>
    <view class="dialog-content">
      <view class="help-item">• 带 <text class="required-mark">*</text> 为必填项</view>
      <view class="help-item">• 器材类型可在系统设置中自定义</view>
      <view class="help-item">• 规格型号支持扫码录入（支持条形码/二维码）</view>
      <view class="help-item">• 数量默认为1，最多可输入999</view>
    </view>
  </view>
</view>