<!-- pages/add/add.wxml -->
<view class="page-container">
  <!-- 页面标题 -->
  <view class="page-header">
    <text class="page-title">{{equipment.id ? '编辑器材' : '添加器材'}}</text>
  </view>

  <!-- 卡片式表单容器 -->
  <view class="form-container">
    <!-- 器材编号（置顶显示） -->
    <view class="form-card" bindtap="{{!equipment.id ? 'focusCodeInput' : ''}}">
      <view class="card-label">
        <text class="label-text">器材编号</text>
        <text class="required">*</text>
      </view>
      <view class="card-content">
        <input 
          id="codeInput"
          value="{{equipment.code}}"
          placeholder="请输入器材编号"
          bindinput="handleInput"
          data-field="code"
          class="card-input"
          disabled="{{equipment.id}}"
        />
        <button 
          class="scan-btn" 
          bindtap="scanCode"
          size="mini"
        >
          <image src="/images/function/func-scan.png" mode="widthFix" class="scan-icon" />
        </button>
      </view>
    </view>

    <!-- 器材名称 -->
    <view class="form-card" bindtap="focusNameInput">
      <view class="card-label">
        <text class="label-text">器材名称</text>
        <text class="required">*</text>
      </view>
      <view class="card-content">
        <input 
          id="nameInput"
          value="{{equipment.name}}"
          placeholder="请输入器材名称"
          bindinput="handleInput"
          data-field="name"
          class="card-input"
        />
      </view>
    </view>

    <!-- 器材类型 -->
    <view class="form-card" bindtap="showTypeSelector">
      <view class="card-label">
        <text class="label-text">器材类型</text>
        <text class="required">*</text>
      </view>
      <view class="card-content select-content">
        <text class="select-text">{{equipment.type || '请选择器材类型'}}</text>
        <image src="/images/function/func-arrow-right.png" mode="widthFix" class="select-arrow" />
      </view>
    </view>

    <!-- 自定义类型输入框 -->
    <view class="form-card custom-input-card" wx:if="{{showCustomType}}">
      <view class="card-content custom-input-content">
        <input 
          id="customTypeInput"
          value="{{customType}}"
          placeholder="请输入自定义类型"
          bindinput="handleCustomTypeInput"
          class="custom-input"
          focus
        />
        <button class="confirm-btn" bindtap="confirmCustomType">确认</button>
      </view>
    </view>

    <!-- 规格型号 -->
    <view class="form-card" bindtap="showSpecificationSelector">
      <view class="card-label">
        <text class="label-text">规格型号</text>
      </view>
      <view class="card-content select-content">
        <text class="select-text">{{equipment.specification || '请选择规格型号'}}</text>
        <image src="/images/function/func-arrow-right.png" mode="widthFix" class="select-arrow" />
      </view>
    </view>

    <!-- 自定义规格输入框 -->
    <view class="form-card custom-input-card" wx:if="{{showCustomSpecification}}">
      <view class="card-content custom-input-content">
        <input 
          id="customSpecificationInput"
          value="{{customSpecification}}"
          placeholder="请输入自定义规格"
          bindinput="handleCustomSpecificationInput"
          class="custom-input"
          focus
        />
        <button class="confirm-btn" bindtap="confirmCustomSpecification">确认</button>
      </view>
    </view>

    <!-- 存放位置 -->
    <view class="form-card" bindtap="showLocationSelector">
      <view class="card-label">
        <text class="label-text">存放位置</text>
        <text class="required">*</text>
      </view>
      <view class="card-content select-content">
        <text class="select-text">{{equipment.location || '请选择存放位置'}}</text>
        <image src="/images/function/func-arrow-right.png" mode="widthFix" class="select-arrow" />
      </view>
    </view>

    <!-- 自定义位置输入框 -->
    <view class="form-card custom-input-card" wx:if="{{showCustomLocation}}">
      <view class="card-content custom-input-content">
        <input 
          id="customLocationInput"
          value="{{customLocation}}"
          placeholder="请输入自定义位置"
          bindinput="handleCustomLocationInput"
          class="custom-input"
          focus
        />
        <button class="confirm-btn" bindtap="confirmCustomLocation">确认</button>
      </view>
    </view>

    <!-- 数量 -->
    <view class="form-card" bindtap="focusQuantityInput">
      <view class="card-label">
        <text class="label-text">数量</text>
        <text class="required">*</text>
      </view>
      <view class="card-content quantity-content">
        <button 
          class="quantity-btn minus" 
          bindtap="decreaseQuantity"
          size="mini"
          disabled="{{equipment.quantity <= 1}}"
        >
          -
        </button>
        <input 
          id="quantityInput"
          value="{{equipment.quantity}}"
          type="number"
          bindinput="handleQuantityInput"
          bindblur="validateQuantity"
          class="quantity-input"
          input-mode="numeric"
          placeholder="1"
        />
        <button 
          class="quantity-btn plus" 
          bindtap="increaseQuantity"
          size="mini"
        >
          +
        </button>
      </view>
    </view>

    <!-- 状态 -->
    <view class="form-card" bindtap="showStatusSelector">
      <view class="card-label">
        <text class="label-text">状态</text>
        <text class="required">*</text>
      </view>
      <view class="card-content select-content">
        <text class="select-text">{{equipment.status || '请选择状态'}}</text>
        <image src="/images/function/func-arrow-right.png" mode="widthFix" class="select-arrow" />
      </view>
    </view>

    <!-- 自定义状态输入框 -->
    <view class="form-card custom-input-card" wx:if="{{showCustomStatus}}">
      <view class="card-content custom-input-content">
        <input 
          id="customStatusInput"
          value="{{customStatus}}"
          placeholder="请输入自定义状态"
          bindinput="handleCustomStatusInput"
          class="custom-input"
          focus
        />
        <button class="confirm-btn" bindtap="confirmCustomStatus">确认</button>
      </view>
    </view>

    <!-- 备注 -->
    <view class="form-card" bindtap="focusRemarksInput">
      <view class="card-label">
        <text class="label-text">备注</text>
      </view>
      <view class="card-content remarks-content">
        <textarea 
          id="remarksInput"
          value="{{equipment.remarks}}"
          placeholder="请输入备注信息（选填，最多200字）"
          bindinput="handleInput"
          data-field="remarks"
          class="card-textarea"
          auto-height
          maxlength="200"
        />
        <text class="text-count">{{equipment.remarks.length || 0}}/200</text>
      </view>
    </view>
  </view>

  <!-- 操作按钮 -->
  <view class="form-actions">
    <button class="btn cancel-btn" bindtap="cancel">取消</button>
    <button class="btn save-btn" bindtap="saveEquipment">
      {{equipment.id ? '更新' : '保存'}}
    </button>
  </view>

  <!-- 类型选择器 -->
  <view class="picker-container" wx:if="{{showTypePicker}}">
    <view class="picker-mask" bindtap="hideTypeSelector"></view>
    <view class="picker-view">
      <view class="picker-title">
        <text class="picker-cancel" bindtap="hideTypeSelector">取消</text>
        <text class="picker-title-text">选择器材类型</text>
        <text class="picker-confirm" bindtap="confirmTypeSelection">确认</text>
      </view>
      <picker-view 
        indicator-style="height: 50rpx;"
        style="width: 100%; height: 400rpx;"
        value="{{typeIndex}}"
        bindchange="onTypeChange"
      >
        <picker-view-column>
          <view class="picker-item" wx:for="{{typeOptions}}" wx:key="index">{{item}}</view>
        </picker-view-column>
      </picker-view>
    </view>
  </view>

  <!-- 规格型号选择器 -->
  <view class="picker-container" wx:if="{{showSpecificationPicker}}">
    <view class="picker-mask" bindtap="hideSpecificationSelector"></view>
    <view class="picker-view">
      <view class="picker-title">
        <text class="picker-cancel" bindtap="hideSpecificationSelector">取消</text>
        <text class="picker-title-text">选择规格型号</text>
        <text class="picker-confirm" bindtap="confirmSpecificationSelection">确认</text>
      </view>
      <picker-view 
        indicator-style="height: 50rpx;"
        style="width: 100%; height: 400rpx;"
        value="{{specificationIndex}}"
        bindchange="onSpecificationChange"
      >
        <picker-view-column>
          <view class="picker-item" wx:for="{{specificationOptions}}" wx:key="index">{{item}}</view>
        </picker-view-column>
      </picker-view>
    </view>
  </view>

  <!-- 存放位置选择器 -->
  <view class="picker-container" wx:if="{{showLocationPicker}}">
    <view class="picker-mask" bindtap="hideLocationSelector"></view>
    <view class="picker-view">
      <view class="picker-title">
        <text class="picker-cancel" bindtap="hideLocationSelector">取消</text>
        <text class="picker-title-text">选择存放位置</text>
        <text class="picker-confirm" bindtap="confirmLocationSelection">确认</text>
      </view>
      <picker-view 
        indicator-style="height: 50rpx;"
        style="width: 100%; height: 400rpx;"
        value="{{locationIndex}}"
        bindchange="onLocationChange"
      >
        <picker-view-column>
          <view class="picker-item" wx:for="{{locationOptions}}" wx:key="index">{{item}}</view>
        </picker-view-column>
      </picker-view>
    </view>
  </view>

  <!-- 状态选择器 -->
  <view class="picker-container" wx:if="{{showStatusPicker}}">
    <view class="picker-mask" bindtap="hideStatusSelector"></view>
    <view class="picker-view">
      <view class="picker-title">
        <text class="picker-cancel" bindtap="hideStatusSelector">取消</text>
        <text class="picker-title-text">选择状态</text>
        <text class="picker-confirm" bindtap="confirmStatusSelection">确认</text>
      </view>
      <picker-view 
        indicator-style="height: 50rpx;"
        style="width: 100%; height: 400rpx;"
        value="{{statusIndex}}"
        bindchange="onStatusChange"
      >
        <picker-view-column>
          <view class="picker-item" wx:for="{{statusOptions}}" wx:key="index">{{item}}</view>
        </picker-view-column>
      </picker-view>
    </view>
  </view>
</view>
    